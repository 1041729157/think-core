
<div class="form-group item_{$form.name} {$form.extra_class}">
    <label class="left control-label">{$form.title}：</label>
    <div class="right">
        <input type="text" id="{$gid}" class="form-control input time" autocomplete="off" name="{$form.name}" value="{$form.value}" {$form.extra_attr}>

        <notempty name="form.tip">
            <span class="check-tips small">{$form.tip}</span>
        </notempty>
        <script type="text/javascript">
            var datetimeRegex = /^\d{4}-\d{2}-\d{2}( \d{2}:\d{2}:\d{2}(\.\d+)?)?$/;

            function isValidDateString(dateString) {
                return datetimeRegex.test(dateString) || !isNaN(parseInt(dateString, 10));
            }

            function datetimeStringToTimestamp(dateString) {
                if (isValidDateString(dateString)) {
                    let date;
                    if (dateRegex.test(dateString)) {
                        date = new Date(dateString);
                    } else {
                        // 推测dateString是一个时间戳
                        const timestamp = parseInt(dateString, 10);
                        if (!isNaN(timestamp)) {
                            date = new Date(timestamp * 1000);
                        }
                    }

                    // 检查是否成功转换成Date对象
                    if (date && !isNaN(date.getTime())) {
                        // 将Date对象格式化为"YYYY-MM-DD"格式的字符串
                        const year = date.getFullYear();
                        const month = (date.getMonth() + 1).toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false });
                        const day = date.getDate().toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false });
                        const hours = date.getHours().toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false });
                        const minutes = date.getMinutes().toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false });
                        const seconds = date.getSeconds().toLocaleString('en-US', { minimumIntegerDigits: 2, useGrouping: false });

                        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                    } else {
                        return null;
                    }
                } else {
                    return null;
                }
            }

            jQuery(document).ready(function () {

                $('#{$gid}').val(datetimeStringToTimestamp($('#{$gid}').val()));

                var default_options = {
                    format      : 'yyyy-mm-dd hh:ii:ss',
                    showSecond  : true,
                    autoclose   : true,
                    todayBtn    : 'linked',
                    language    : 'zh-CN',
                    fontAwesome : true,
                    stepMinute: 1,
                    stepSecond: 1
                };
                var cus_options = {:json_encode($opt)} || {};
                var time_options = $.extend({}, default_options, cus_options);
                $('#{$gid}').datetimepicker(time_options);
            });
        </script>
    </div>
</div>
